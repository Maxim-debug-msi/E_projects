#include <iostream>
#include <fstream>
#include <ctime>
#include <cstdlib>
#include <iterator>
#include <algorithm>

void filling_ATM(int *arr, const int SIZE)
{
    int banknote;
    for(int i = 0; i < SIZE; i++)
    if(*(arr + i) <= 0)
    {
        banknote = rand() % 3000;
        banknote = (banknote >= 2500) ? 5000 : (banknote >= 1500) ? 2000 :
                (banknote >= 750) ? 1000 : (banknote >= 250) ? 500 : (banknote >= 150) ? 200 : 100;
        *(arr + i) = banknote;
    }
}

void cash_withdrawal(int *arr, const int SIZE, int &amount)
{
    for(int i = 0; i < SIZE && amount > 0; i++)
    {
        if(amount - *(arr + i) >= 0 && *(arr + i) != 0)
        {
            amount -= *(arr + i);
            *(arr + i) = 0;
        }
    }
    if(amount > 0) std::cout<<"No bills to issue."<<std::endl;
    else std::cout<<"Cash withdrawal successful!"<<std::endl;
}

int main() {
    srand(time(nullptr));

    const int SIZE = 1000;
    int banknotes[SIZE] = {0};
    int amount, i = 0;
    char c;

    std::ifstream ATM("C:\\E_files\\ATM.bin", std::ios::binary | std::ios::app);
    while(!ATM.eof()) ATM >> *(banknotes + i++);
    ATM.close();

    std::cout<<"Enter the operation(+ or -)"<<std::endl;
    std::cin >> c;
    if(c == '+')
    {
        filling_ATM(banknotes, SIZE);

        std::ofstream ATM("C:\\E_files\\ATM.bin", std::ios::binary);
        std::copy(banknotes, banknotes + SIZE, std::ostream_iterator<int>(ATM, "\n"));
        ATM.close();
    }
    else
    {
        do {
            std::cout << "Enter the withdrawal amount(multiple of 100):" << std::endl;
            std::cin >> amount;
            if(amount%100 != 0) std::cout<<"Incorrect amount! Try again."<<std::endl;
        }while(amount%100 != 0);

        cash_withdrawal(banknotes, SIZE, amount);

        std::ofstream ATM("C:\\E_files\\ATM.bin", std::ios::binary);
        std::copy(banknotes, banknotes + SIZE, std::ostream_iterator<int>(ATM, "\n"));
        ATM.close();
    }
    return 0;
}
